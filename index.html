<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BareVault Object Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1400.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        minio: {
                            bg: '#0a0f1c',
                            panel: '#111827',
                            sidebar: '#0f1423',
                            border: '#1f2937',
                            accent: '#ef4444',
                            text: '#d1d5db'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-minio-bg text-minio-text font-sans h-[100dvh] flex overflow-hidden">

    <div id="globalLoader"
        class="absolute inset-0 z-[100] flex flex-col items-center justify-center bg-minio-bg transition-opacity duration-300">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-minio-accent mb-4"></div>
        <p class="text-sm text-gray-400 font-medium animate-pulse">Establishing secure connection...</p>
    </div>

    <div id="previewModal"
        class="absolute inset-0 z-[200] hidden flex-col items-center justify-center bg-black/80 backdrop-blur-sm transition-opacity">
        <div
            class="w-full max-w-6xl h-full max-h-[90vh] flex flex-col bg-minio-panel rounded-lg shadow-2xl border border-minio-border overflow-hidden m-4">
            <div class="p-4 border-b border-minio-border flex justify-between items-center bg-minio-sidebar shrink-0">
                <div class="flex items-center text-sm font-bold text-white truncate px-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-5 h-5 mr-3 text-indigo-400">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span id="previewTitle" class="truncate">Preview</span>
                </div>
                <button onclick="closePreview()"
                    class="text-gray-400 hover:text-white bg-gray-800/50 hover:bg-gray-700 p-2 rounded-md transition-colors flex items-center">
                    <span class="text-xs font-bold mr-2 uppercase tracking-wide">Close</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div
                class="flex-1 w-full h-full bg-[#050811] flex items-center justify-center p-2 relative overflow-hidden">
                <img id="previewImage" class="hidden max-w-full max-h-full object-contain" src="" alt="Preview">
                <iframe id="previewFrame" class="hidden w-full h-full rounded border-none bg-white/5"
                    allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="paywallAdminModal" class="absolute inset-0 z-[300] hidden flex-col items-center justify-center bg-minio-bg/95 backdrop-blur-sm transition-opacity">
        <div class="bg-minio-panel border border-minio-border p-8 rounded-lg max-w-md w-full text-center shadow-2xl m-4">
            <div class="w-16 h-16 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
            </div>
            <h2 class="text-2xl font-black text-white tracking-wide mb-2">Trial Expired</h2>
            <p class="text-sm text-gray-400 mb-8 leading-relaxed">Your 7-day trial has concluded. Upgrade to Premium to instantly restore team access and unlock unlimited storage.</p>
            <a id="stripeCheckoutBtn" href="#" target="_blank" class="block w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3.5 rounded transition-colors shadow-lg mb-4">
                Upgrade to Premium
            </a>
            <button onclick="logout()" class="text-xs text-gray-500 hover:text-white transition-colors uppercase tracking-widest font-bold">Sign Out</button>
        </div>
    </div>

    <div id="paywallEmployeeModal" class="absolute inset-0 z-[300] hidden flex-col items-center justify-center bg-minio-bg/95 backdrop-blur-sm transition-opacity">
        <div class="bg-minio-panel border border-minio-border p-8 rounded-lg max-w-md w-full text-center shadow-2xl m-4">
             <div class="w-16 h-16 bg-gray-800 text-gray-400 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 9v6m-4.5 0V9M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </div>
            <h2 class="text-2xl font-black text-white tracking-wide mb-2">Workspace Suspended</h2>
            <p class="text-sm text-gray-400 mb-8 leading-relaxed">The administrator's subscription for this workspace has expired. Please contact your team admin to restore access.</p>
            <button onclick="logout()" class="block w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-3.5 rounded transition-colors shadow-lg">Sign Out</button>
        </div>
    </div>

    <div id="teamModal"
        class="absolute inset-0 z-[250] hidden flex-col items-center justify-center bg-black/80 backdrop-blur-sm transition-opacity">
        <div
            class="w-full max-w-4xl bg-minio-panel rounded-lg shadow-2xl border border-minio-border overflow-hidden m-4">
            <div class="p-4 border-b border-minio-border flex justify-between items-center bg-minio-sidebar shrink-0">
                <h2 class="text-sm font-bold text-white flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-5 h-5 mr-2 text-indigo-400">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                    </svg>
                    Manage Team Access
                </h2>
                <button onclick="document.getElementById('teamModal').classList.add('hidden')"
                    class="text-gray-400 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-0 max-h-[60vh] overflow-y-auto">
                <table class="w-full text-left text-sm text-gray-300">
                    <thead class="text-[10px] uppercase bg-gray-800 text-gray-400 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 font-bold tracking-wider">Employee Name</th>
                            <th class="px-6 py-3 font-bold tracking-wider">Role</th>
                            <th class="px-6 py-3 font-bold tracking-wider">Access Key</th>
                            <th class="px-6 py-3 text-right font-bold tracking-wider">Action</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="loginScreen" class="absolute inset-0 z-50 flex flex-col lg:flex-row w-full h-full bg-minio-bg hidden">
        <div
            class="hidden lg:flex flex-col justify-center w-1/2 p-16 border-r border-minio-border relative overflow-hidden">
            <h1 class="text-4xl font-bold text-white mb-4">High-Performance Object Store</h1>
            <p class="text-sm text-gray-400 leading-relaxed max-w-md z-10">
                BareVault is a cloud-native object store built to run on any infrastructure - public, private or edge
                clouds. Primary use cases include mobile applications, SaaS, and fast backup & recovery.
            </p>
            <div class="absolute bottom-0 left-0 w-full h-1/2 opacity-20 bg-gradient-to-t from-blue-500 to-transparent">
            </div>
        </div>

        <div class="flex flex-col justify-center items-center w-full lg:w-1/2 p-8 bg-minio-panel">
            <div class="w-full max-w-sm">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-black text-white tracking-wider">BARE<span
                            class="text-minio-accent">VAULT</span></h2>
                    <span
                        class="inline-block mt-2 bg-slate-800 text-xs font-bold px-2 py-1 rounded text-gray-300 border border-slate-600">Universal
                        Client Portal</span>
                </div>

                <div class="space-y-4">
                    <div>
                        <input type="text" id="endpointUrl" placeholder="API Endpoint (e.g., https://...)"
                            class="w-full bg-transparent border border-minio-border rounded p-3 text-sm focus:border-minio-accent focus:outline-none transition-colors">
                    </div>
                    <div>
                        <input type="text" id="accessKey" placeholder="Access Key"
                            class="w-full bg-transparent border border-minio-border rounded p-3 text-sm focus:border-minio-accent focus:outline-none transition-colors">
                    </div>
                    <div class="relative">
                        <input type="password" id="secretKey" placeholder="Secret Key"
                            class="w-full bg-transparent border border-minio-border rounded p-3 text-sm focus:border-minio-accent focus:outline-none transition-colors pr-12">
                        <button onclick="togglePassword()"
                            class="absolute inset-y-0 right-0 px-4 flex items-center text-gray-500 hover:text-gray-300 focus:outline-none">
                            <svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                </path>
                            </svg>
                        </button>
                    </div>

                    <button onclick="authenticate()"
                        class="w-full bg-gray-200 hover:bg-white text-gray-900 font-bold py-3 rounded text-sm transition-colors mt-4">
                        Login
                    </button>
                    <p id="loginError" class="text-red-400 text-xs text-center mt-2 hidden"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardScreen" class="hidden w-full h-full flex">

        <div class="w-64 bg-minio-sidebar border-r border-minio-border flex flex-col justify-between shrink-0">
            <div class="flex-1 flex flex-col overflow-hidden">
                <div class="p-4 border-b border-minio-border">
                    <h2 class="text-xl font-black text-white tracking-wider">BARE<span
                            class="text-minio-accent">VAULT</span></h2>
                </div>

                <div class="p-4 flex-1 flex flex-col overflow-hidden">
                    <button id="btnCreateBucket" onclick="createBucket()"
                        class="w-full bg-minio-panel border border-minio-border hover:bg-gray-800 text-white font-medium py-2 px-4 rounded flex items-center justify-center mb-2 text-sm transition-colors hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="w-4 h-4 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        Create Bucket
                    </button>

                    <button id="btnGenerateInvite" onclick="generateInvite()"
                        class="w-full bg-transparent border border-minio-border hover:bg-gray-800 text-gray-300 font-medium py-2 px-4 rounded flex items-center justify-center mb-6 text-sm transition-colors hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-4 h-4 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
                        </svg>
                        Team Invite Link
                    </button>

                    <div class="mb-2">
                        <input type="text" id="bucketSearch" oninput="filterBuckets()" placeholder="Filter Buckets"
                            class="w-full bg-transparent border border-minio-border rounded p-2 text-xs focus:border-gray-500 focus:outline-none">
                    </div>

                    <div class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 mt-4">Buckets</div>
                    <ul id="bucketListSidebar" class="space-y-1 overflow-y-auto flex-1">
                    </ul>
                </div>
            </div>

            <div class="p-4 border-t border-minio-border space-y-2 shrink-0 pb-8 overflow-y-auto">
                <a id="btnSidebarUpgrade" href="#" target="_blank"
                    class="w-full text-left text-xs font-bold text-indigo-400 hover:text-indigo-300 flex items-center p-2 rounded hover:bg-minio-panel transition-colors hidden mb-2 border border-indigo-900/30 bg-indigo-900/10">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-4 h-4 mr-3">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                    </svg>
                    Upgrade to Premium
                </a>
                
                <button id="btnManageTeam" onclick="openTeamManager()"
                    class="w-full text-left text-xs font-medium text-gray-400 hover:text-white flex items-center p-2 rounded hover:bg-minio-panel transition-colors hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-4 h-4 mr-3">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                    </svg>
                    Manage Team
                </button>
                <button onclick="logout()"
                    class="w-full text-left text-xs font-medium text-gray-400 hover:text-white flex items-center p-2 rounded hover:bg-minio-panel transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-4 h-4 mr-3">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                    </svg>
                    Sign Out
                </button>
            </div>
        </div>

        <div class="flex-1 flex flex-col bg-minio-bg overflow-hidden">

            <div class="h-14 border-b border-minio-border flex items-center justify-between px-6 shrink-0">
                <h2 class="text-sm font-bold text-white tracking-wide">Object Browser</h2>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" id="objectSearch" oninput="filterObjects()"
                            placeholder="Start typing to filter objects..."
                            class="bg-minio-panel border border-minio-border rounded p-1.5 pl-8 text-xs w-72 focus:outline-none focus:border-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="w-3.5 h-3.5 absolute left-2.5 top-2 text-gray-500">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="flex-1 flex flex-row overflow-hidden">

                <div class="flex-1 flex flex-col p-6 overflow-hidden">
                    <div
                        class="bg-minio-panel border border-minio-border rounded-lg flex flex-col h-full overflow-hidden shadow-lg">

                        <div class="p-4 border-b border-minio-border flex justify-between items-center shrink-0">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3 text-gray-400">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                                </svg>
                                <div>
                                    <span id="currentBucketName" class="font-bold text-white text-base">Select a
                                        bucket</span>
                                    <div class="text-[10px] text-gray-500 mt-0.5"><span id="bucketStats">Access:
                                            PRIVATE</span></div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="refreshCurrentBucket()"
                                    class="bg-transparent border border-minio-border hover:bg-gray-800 text-gray-300 px-3 py-1.5 rounded text-xs font-medium transition-colors flex items-center">
                                    Refresh
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5 ml-2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                    </svg>
                                </button>
                                
                                <input type="file" id="fileUploadInput" class="hidden" multiple onchange="uploadFiles(event)">
                                <button id="btnUpload" onclick="document.getElementById('fileUploadInput').click()"
                                    class="bg-white hover:bg-gray-200 text-gray-900 px-4 py-1.5 rounded text-xs font-bold transition-colors flex items-center shadow-sm">
                                    Upload
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-4 h-4 ml-2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                                    </svg>
                                </button>

                                <button id="btnDeleteBucket" onclick="deleteCurrentBucket()"
                                    class="hidden bg-transparent border border-red-900/40 text-red-500 hover:bg-red-900/20 px-3 py-1.5 rounded text-xs font-bold transition-colors items-center ml-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="2" stroke="currentColor" class="w-3.5 h-3.5 mr-1">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </div>

                        <div id="uploadProgressContainer" class="hidden w-full h-1 bg-minio-sidebar shrink-0">
                            <div id="uploadProgressBar" class="h-full bg-minio-accent w-0 transition-all duration-200">
                            </div>
                        </div>

                        <div
                            class="grid grid-cols-12 gap-4 p-3 border-b border-minio-border text-[11px] font-bold text-gray-400 uppercase tracking-wide shrink-0 bg-[#0f1423]">
                            <div class="col-span-1 text-center"><input type="checkbox" id="selectAllCheckbox"
                                    onclick="toggleAllFiles(this)"
                                    class="bg-transparent border-gray-600 rounded cursor-pointer"></div>
                            <div class="col-span-6 flex items-center"><span class="ml-1">Name</span></div>
                            <div class="col-span-3">Last Modified</div>
                            <div class="col-span-2 text-right">Size</div>
                        </div>

                        <div id="objectList" class="flex-1 overflow-y-auto">
                            <div class="p-8 text-center text-sm text-gray-500">
                                Select a bucket from the sidebar to view objects.
                            </div>
                        </div>
                    </div>
                </div>

                <div id="objectDetailsDrawer"
                    class="hidden w-[340px] border-l border-minio-border bg-minio-sidebar flex flex-col overflow-y-auto shrink-0 z-10">
                    <div
                        class="p-4 border-b border-minio-border flex justify-between items-center sticky top-0 bg-minio-sidebar">
                        <div class="flex items-center text-xs font-bold text-white truncate max-w-[260px]">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-4 h-4 mr-2 text-indigo-400 shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                            <span id="drawerFileName" class="truncate">filename.jpg</span>
                        </div>
                        <button onclick="closeDrawer()" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <div class="p-5 space-y-6 flex-1">
                        <div>
                            <h3 class="text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-3">Actions:</h3>
                            <div class="border border-minio-border rounded-md bg-minio-bg overflow-hidden shadow-sm">
                                <button onclick="downloadSelected()"
                                    class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                    </svg>
                                    Download
                                </button>

                                <button onclick="shareSelected()"
                                    class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
                                    </svg>
                                    Share
                                </button>

                                <button onclick="previewSelected()"
                                    class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    Preview
                                </button>

                                <button onclick="tagsSelected()"
                                    class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                                    </svg>
                                    Tags
                                </button>
                            </div>

                            <button onclick="deleteSelected()"
                                class="w-full mt-3 px-4 py-2.5 text-xs text-red-500 border border-red-900/40 hover:bg-red-900/20 rounded-md font-medium transition-colors flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                </svg>
                                Delete
                            </button>
                        </div>

                        <div class="pt-2">
                            <h3
                                class="text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center justify-between">
                                Object Info
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" class="w-4 h-4 text-gray-500">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                                </svg>
                            </h3>
                            <div class="space-y-4 text-xs">
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Name:</span>
                                    <span class="text-gray-200 break-all" id="drawerName">...</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Size:</span>
                                    <span class="text-gray-200" id="drawerSize">...</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Last Modified:</span>
                                    <span class="text-gray-200" id="drawerDate">...</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">ETAG:</span>
                                    <span class="text-gray-400 break-all font-mono text-[10px]"
                                        id="drawerEtag">...</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Tags:</span>
                                    <span class="text-gray-200" id="drawerTags">N/A</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Legal Hold:</span>
                                    <span class="text-gray-200">Off</span>
                                </div>
                                <div>
                                    <span class="block text-gray-400 mb-1 font-medium">Retention Policy:</span>
                                    <span class="text-gray-200">None</span>
                                </div>

                                <div class="pt-2">
                                    <h4 class="text-gray-300 font-bold mb-2 flex items-center justify-between">
                                        Metadata
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-gray-500">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                        </svg>
                                    </h4>
                                    <span
                                        class="block text-gray-400 mb-1 font-medium text-[10px] uppercase">Content-Type</span>
                                    <span class="text-gray-200 break-all"
                                        id="drawerContentType">application/octet-stream</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div id="toastContainer" class="fixed bottom-6 right-6 z-[300] flex flex-col gap-3 pointer-events-none"></div>
    <script>
        let s3 = null;
        let activeBucket = '';
        let selectedObjectKey = '';
        let selectedFiles = new Set();

        function togglePassword() {
            const input = document.getElementById('secretKey');
            const eyeIcon = document.getElementById('eyeIcon');

            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>`;
            } else {
                input.type = 'password';
                eyeIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>`;
            }
        }

        async function resolveEndpoint(url) {
            if (!url.includes("barevault-gateway")) return url;
            try {
                const resolveUrl = new URL(url);
                resolveUrl.searchParams.append("resolve", "true");
                const res = await fetch(resolveUrl.toString(), { method: 'GET' });
                if (!res.ok) return null;
                const activeEdgeLink = await res.text();
                return activeEdgeLink.trim();
            } catch (e) {
                console.error(e);
                return null;
            }
        }

        window.onload = async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteToken = urlParams.get('invite');
            const gatewayURL = urlParams.get('gateway');

            if (inviteToken && gatewayURL) {
                await redeemInvite(inviteToken, gatewayURL);
                return;
            }

            const savedEndpoint = localStorage.getItem('bv_endpoint');
            const savedAccess = localStorage.getItem('bv_access');
            const savedSecret = localStorage.getItem('bv_secret');

            if (savedEndpoint && savedAccess && savedSecret) {
                const activeEndpoint = await resolveEndpoint(savedEndpoint);
                if (activeEndpoint) {
                    initAWS(activeEndpoint, savedAccess, savedSecret);
                    return;
                }
            }

            document.getElementById('globalLoader').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        };

        async function redeemInvite(token, gatewayURL) {
            if (!gatewayURL.startsWith('http')) gatewayURL = 'https://' + gatewayURL;
            
            document.getElementById('globalLoader').classList.remove('hidden');
            document.querySelector('#globalLoader p').innerText = "Connecting to Workspace...";

            const employeeName = prompt("Welcome! Please enter your name to join the workspace:");
            if (!employeeName) {
                alert("Name is required to join.");
                window.location.href = window.location.href.split('?')[0];
                return;
            }

            try {
                const adminEndpoint = gatewayURL.replace('-api', '-admin');
                const adminEdgeLink = await resolveEndpoint(adminEndpoint);

                if (!adminEdgeLink) throw new Error("Could not connect to the Host Engine. It may be offline.");

                const res = await fetch(adminEdgeLink + '/api/invite/redeem', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: token, name: employeeName })
                });

                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error(errText || "Unknown Backend Error");
                }

                const data = await res.json();

                if (data.status === 'success') {
                    localStorage.setItem('bv_endpoint', gatewayURL);
                    localStorage.setItem('bv_access', data.access_key);
                    localStorage.setItem('bv_secret', data.secret_key);

                    alert(`Success! Welcome, ${employeeName}. You are securely logged in.`);
                    window.location.href = window.location.href.split('?')[0];
                }

            } catch (error) {
                alert("Redemption Error: " + error.message);
                window.location.href = window.location.href.split('?')[0];
            }
        }

        async function authenticate() {
            let rawEndpoint = document.getElementById('endpointUrl').value.trim();
            const access = document.getElementById('accessKey').value.trim();
            const secret = document.getElementById('secretKey').value.trim();

            if (rawEndpoint && !rawEndpoint.startsWith('http')) {
                rawEndpoint = 'https://' + rawEndpoint;
                document.getElementById('endpointUrl').value = rawEndpoint;
            }

            if (!rawEndpoint || !access || !secret) {
                showError("All fields are required.");
                return;
            }

            document.getElementById('loginError').classList.remove('hidden');
            document.getElementById('loginError').className = "text-indigo-400 text-xs text-center mt-2 animate-pulse";
            document.getElementById('loginError').innerText = "Resolving Gateway...";

            const activeEndpoint = await resolveEndpoint(rawEndpoint);

            if (!activeEndpoint) {
                document.getElementById('loginError').className = "text-red-400 text-xs text-center mt-2";
                showError("Gateway timeout. Ensure the Go engine is running on the host machine.");
                return;
            }

            localStorage.setItem('bv_endpoint', rawEndpoint);
            localStorage.setItem('bv_access', access);
            localStorage.setItem('bv_secret', secret);

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('globalLoader').classList.remove('hidden');

            initAWS(activeEndpoint, access, secret);
        }

        async function initAWS(endpoint, access, secret) {
            const isAdmin = access.startsWith('bv_admin_');

            // ðŸ”¥ 1. CHECK BILLING/LOCK STATUS FIRST
            try {
                const adminEndpoint = endpoint.replace('-api', '-admin');
                const adminEdgeLink = await resolveEndpoint(adminEndpoint);
                
                const billRes = await fetch(adminEdgeLink + '/api/billing/status');
                const billData = await billRes.json();
                
                if (billData.expired === true) {
                    document.getElementById('globalLoader').classList.add('hidden');
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('dashboardScreen').classList.add('hidden');
                    
                    if (isAdmin) {
                        document.getElementById('paywallAdminModal').classList.remove('hidden');
                        document.getElementById('paywallAdminModal').classList.add('flex');
                        
                        // Dynamically attach hardware ID to checkout link
                        const checkoutLink = `https://buy.stripe.com/test_YOUR_STRIPE_LINK?client_reference_id=${billData.machine_id}`;
                        document.getElementById('stripeCheckoutBtn').href = checkoutLink;
                    } else {
                        document.getElementById('paywallEmployeeModal').classList.remove('hidden');
                        document.getElementById('paywallEmployeeModal').classList.add('flex');
                    }
                    return; // ðŸ›‘ HALT EXECUTION. Do not connect to S3.
                }

                // Show persistent upgrade button if they are an Admin on Trial
                if (isAdmin && !billData.is_paid) {
                    const btn = document.getElementById('btnSidebarUpgrade');
                    btn.classList.remove('hidden');
                    btn.classList.add('flex');
                    btn.href = `https://buy.stripe.com/test_YOUR_STRIPE_LINK?client_reference_id=${billData.machine_id}`;
                }
            } catch(e) {
                console.log("Billing check skipped or offline.", e);
            }

            // 2. If active, proceed normally
            AWS.config.update({
                accessKeyId: access,
                secretAccessKey: secret,
                region: 'us-east-1',
                s3ForcePathStyle: true,
                endpoint: new AWS.Endpoint(endpoint)
            });
            s3 = new AWS.S3();

            if (isAdmin) {
                document.getElementById('btnCreateBucket').classList.remove('hidden');
                document.getElementById('btnCreateBucket').classList.add('flex');
                document.getElementById('btnGenerateInvite').classList.remove('hidden');
                document.getElementById('btnGenerateInvite').classList.add('flex');
                document.getElementById('btnManageTeam').classList.remove('hidden');
                document.getElementById('btnManageTeam').classList.add('flex');
                document.getElementById('btnDeleteBucket').classList.remove('hidden');
                document.getElementById('btnDeleteBucket').classList.add('flex');
            } else {
                document.getElementById('btnCreateBucket').style.display = 'none';
                document.getElementById('btnGenerateInvite').style.display = 'none';
                document.getElementById('btnManageTeam').style.display = 'none';
                document.getElementById('btnDeleteBucket').style.display = 'none';
            }

            fetchBuckets(true);
        }

        function fetchBuckets(isInitialLoad = false) {
            s3.listBuckets(function (err, data) {
                document.getElementById('globalLoader').classList.add('hidden');

                if (err) {
                    document.getElementById('loginScreen').classList.remove('hidden');
                    document.getElementById('loginError').className = "text-red-400 text-xs text-center mt-2 break-words";
                    showError("AWS ERROR: [" + err.code + "] " + err.message);
                } else {
                    document.getElementById('dashboardScreen').classList.remove('hidden');
                    const sortedBuckets = data.Buckets.sort((a, b) => new Date(b.CreationDate) - new Date(a.CreationDate));
                    renderSidebar(sortedBuckets);

                    if (isInitialLoad && sortedBuckets.length > 0) {
                        loadObjects(sortedBuckets[0].Name);
                    } else if (activeBucket) {
                        loadObjects(activeBucket);
                    }
                }
            });
        }

        function renderSidebar(buckets) {
            const list = document.getElementById('bucketListSidebar');
            list.innerHTML = '';
            buckets.forEach(b => {
                list.innerHTML += `
                    <li data-bucket="${b.Name.toLowerCase()}" class="bucket-item">
                        <button id="bucket-btn-${b.Name}" onclick="loadObjects('${b.Name}')" class="bucket-btn w-full text-left px-3 py-1.5 text-sm text-gray-400 hover:text-white hover:bg-minio-panel rounded transition-colors flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>
                            <span class="truncate">${b.Name}</span>
                        </button>
                    </li>
                `;
            });
        }

        function filterBuckets() {
            const term = document.getElementById('bucketSearch').value.toLowerCase();
            const items = document.querySelectorAll('.bucket-item');
            items.forEach(item => {
                if (item.getAttribute('data-bucket').includes(term)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function filterObjects() {
            const term = document.getElementById('objectSearch').value.toLowerCase();
            const items = document.querySelectorAll('.object-row');
            items.forEach(item => {
                if (item.getAttribute('data-key').toLowerCase().includes(term)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function createBucket() {
            const bucketName = prompt("Enter a new bucket name (lowercase, no spaces, globally unique):");
            if (!bucketName) return;

            s3.createBucket({ Bucket: bucketName.trim() }, function (err, data) {
                if (err) alert("Failed to create bucket: \n" + err.message);
                else {
                    activeBucket = bucketName.trim();
                    fetchBuckets();
                }
            });
        }

        function refreshCurrentBucket() {
            if (activeBucket) loadObjects(activeBucket);
        }

        function loadObjects(bucketName) {
            activeBucket = bucketName;
            selectedFiles.clear();
            document.getElementById('selectAllCheckbox').checked = false;
            closeDrawer();
            document.getElementById('currentBucketName').innerText = bucketName;

            document.querySelectorAll('.bucket-btn').forEach(btn => {
                btn.classList.remove('bg-gray-800', 'text-white');
                btn.classList.add('text-gray-400');
            });
            const activeBtn = document.getElementById('bucket-btn-' + bucketName);
            if (activeBtn) {
                activeBtn.classList.add('bg-gray-800', 'text-white');
                activeBtn.classList.remove('text-gray-400');
            }

            const objList = document.getElementById('objectList');
            objList.innerHTML = '<div class="p-8 text-center text-sm text-gray-500 animate-pulse">Loading objects...</div>';

            s3.listObjectsV2({ Bucket: bucketName }, function (err, data) {
                if (err) {
                    objList.innerHTML = `<div class="p-8 text-center text-sm text-red-400">Error loading objects: ${err.message}</div>`;
                    return;
                }

                document.getElementById('bucketStats').innerText = `Access: PRIVATE`;

                if (data.Contents.length === 0) {
                    objList.innerHTML = '<div class="p-8 text-center text-sm text-gray-500">Bucket is empty.</div>';
                    return;
                }

                const sortedObjects = data.Contents.sort((a, b) => new Date(b.LastModified) - new Date(a.LastModified));
                let html = '';

                sortedObjects.forEach(obj => {
                    const date = new Date(obj.LastModified).toLocaleString();
                    const sizeKB = (obj.Size / 1024).toFixed(1) + ' KiB';
                    const cleanEtag = obj.ETag ? obj.ETag.replace(/"/g, '') : 'N/A';

                    html += `
                        <div onclick="handleRowClick(event, this)" data-key="${obj.Key}" data-size="${sizeKB}" data-date="${date}" data-etag="${cleanEtag}" class="object-row grid grid-cols-12 gap-4 p-3 border-b border-minio-border text-sm text-gray-300 hover:bg-gray-800 transition-colors cursor-pointer group">
                            <div class="col-span-1 text-center" onclick="event.stopPropagation()">
                                <input type="checkbox" onchange="toggleFileSelection('${obj.Key}', this.checked)" class="file-checkbox bg-transparent border-gray-600 rounded mt-1 cursor-pointer">
                            </div>
                            <div class="col-span-6 flex items-center truncate">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2 text-indigo-400 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                                <span class="truncate">${obj.Key}</span>
                            </div>
                            <div class="col-span-3 text-gray-500 text-[11px] flex items-center truncate">${date}</div>
                            <div class="col-span-2 text-right text-gray-500 text-[11px] flex items-center justify-end whitespace-nowrap">${sizeKB}</div>
                        </div>
                    `;
                });
                objList.innerHTML = html;
            });
        }

        function toggleFileSelection(key, isChecked) {
            if (isChecked) selectedFiles.add(key);
            else selectedFiles.delete(key);

            if (!isChecked) document.getElementById('selectAllCheckbox').checked = false;
            updateDrawerForSelection();
        }

        function toggleAllFiles(checkbox) {
            const isChecked = checkbox.checked;
            const checkboxes = document.querySelectorAll('.file-checkbox');
            selectedFiles.clear();

            checkboxes.forEach(cb => {
                cb.checked = isChecked;
                if (isChecked) {
                    const row = cb.closest('.object-row');
                    selectedFiles.add(row.getAttribute('data-key'));
                }
            });
            updateDrawerForSelection();
        }

        function updateDrawerForSelection() {
            if (selectedFiles.size > 1) {
                document.getElementById('objectDetailsDrawer').classList.remove('hidden');
                document.getElementById('drawerFileName').innerText = `${selectedFiles.size} items selected`;

                const drawerContent = document.querySelector('#objectDetailsDrawer .p-5');
                drawerContent.innerHTML = `
                    <div>
                        <h3 class="text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-3">Bulk Actions:</h3>
                        <div class="border border-minio-border rounded-md bg-minio-bg overflow-hidden shadow-sm">
                            <button onclick="downloadBulk()" class="w-full text-left px-4 py-3 text-xs font-bold text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 mr-3 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                                Download ${selectedFiles.size} Files
                            </button>
                        </div>
                        <button onclick="deleteBulk()" class="w-full mt-3 px-4 py-3 text-xs text-red-500 border border-red-900/40 hover:bg-red-900/20 rounded-md font-bold transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                            Delete Selected
                        </button>
                    </div>
                `;
            } else if (selectedFiles.size === 1) {
                const key = Array.from(selectedFiles)[0];
                const row = document.querySelector(`[data-key="${key}"]`);
                handleRowClick(null, row);
            } else {
                closeDrawer();
            }
        }

        function handleRowClick(event, element) {
            if (event && event.target.tagName.toLowerCase() === 'input') return;

            const key = element.getAttribute('data-key');
            const size = element.getAttribute('data-size');
            const date = element.getAttribute('data-date');
            const etag = element.getAttribute('data-etag');

            document.querySelectorAll('.file-checkbox').forEach(cb => cb.checked = false);
            const cb = element.querySelector('.file-checkbox');
            if (cb) cb.checked = true;
            selectedFiles.clear();
            selectedFiles.add(key);

            let contentType = 'application/octet-stream';
            let ext = key.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) contentType = 'image/' + (ext === 'jpg' ? 'jpeg' : ext);
            else if (['mp4', 'webm', 'ogg'].includes(ext)) contentType = 'video/' + ext;
            else if (ext === 'pdf') contentType = 'application/pdf';
            else if (ext === 'txt') contentType = 'text/plain';

            const drawerContent = document.querySelector('#objectDetailsDrawer .p-5');
            drawerContent.innerHTML = `
                <div>
                    <h3 class="text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-3">Actions:</h3>
                    <div class="border border-minio-border rounded-md bg-minio-bg overflow-hidden shadow-sm">
                        <button onclick="downloadSelected()" class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg> Download
                        </button>
                        <button onclick="shareSelected()" class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" /></svg> Share
                        </button>
                        <button onclick="previewSelected()" class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center border-b border-minio-border">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> Preview
                        </button>
                        <button onclick="tagsSelected()" class="w-full text-left px-4 py-2.5 text-xs font-medium text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-3 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" /><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" /></svg> Tags
                        </button>
                    </div>
                    <button onclick="deleteSelected()" class="w-full mt-3 px-4 py-2.5 text-xs text-red-500 border border-red-900/40 hover:bg-red-900/20 rounded-md font-medium transition-colors flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg> Delete
                    </button>
                </div>
                <div class="pt-2 mt-6">
                    <h3 class="text-[11px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center justify-between">
                        Object Info <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-gray-500"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" /></svg>
                    </h3>
                    <div class="space-y-4 text-xs">
                        <div><span class="block text-gray-400 mb-1 font-medium">Name:</span><span class="text-gray-200 break-all" id="drawerName">...</span></div>
                        <div><span class="block text-gray-400 mb-1 font-medium">Size:</span><span class="text-gray-200" id="drawerSize">...</span></div>
                        <div><span class="block text-gray-400 mb-1 font-medium">Last Modified:</span><span class="text-gray-200" id="drawerDate">...</span></div>
                        <div><span class="block text-gray-400 mb-1 font-medium">ETAG:</span><span class="text-gray-400 break-all font-mono text-[10px]" id="drawerEtag">...</span></div>
                        <div><span class="block text-gray-400 mb-1 font-medium text-[10px] uppercase mt-4">Content-Type</span><span class="text-gray-200 break-all" id="drawerContentType">...</span></div>
                    </div>
                </div>
            `;

            openDrawer(key, size, date, etag, contentType);
        }

        async function uploadFiles(event) {
            if (!activeBucket) {
                alert("Please select a bucket first!");
                return;
            }
            const files = event.target.files;
            if (files.length === 0) return;

            document.getElementById('uploadProgressContainer').classList.remove('hidden');
            const totalFiles = files.length;

            for (let i = 0; i < totalFiles; i++) {
                const file = files[i];
                document.getElementById('currentBucketName').innerText = `Uploading ${i + 1}/${totalFiles}: ${file.name}...`;

                const params = {
                    Bucket: activeBucket,
                    Key: file.name,
                    Body: file,
                    ContentType: file.type || 'application/octet-stream'
                };

                const uploadRequest = s3.upload(params);

                uploadRequest.on('httpUploadProgress', function (evt) {
                    const progress = Math.round((evt.loaded * 100) / evt.total);
                    document.getElementById('uploadProgressBar').style.width = progress + '%';
                });

                await uploadRequest.promise().catch(err => alert("Upload Failed: " + err.message));
            }

            event.target.value = '';
            document.getElementById('uploadProgressContainer').classList.add('hidden');
            document.getElementById('uploadProgressBar').style.width = '0%';
            loadObjects(activeBucket);
        }

        function openDrawer(key, size, date, etag, contentType) {
            selectedObjectKey = key;
            document.getElementById('objectDetailsDrawer').classList.remove('hidden');
            document.getElementById('drawerFileName').innerText = key;
            document.getElementById('drawerName').innerText = key;
            document.getElementById('drawerSize').innerText = size;
            document.getElementById('drawerDate').innerText = date;
            document.getElementById('drawerEtag').innerText = etag;
            document.getElementById('drawerContentType').innerText = contentType;
        }

        function closeDrawer() {
            selectedObjectKey = '';
            document.getElementById('objectDetailsDrawer').classList.add('hidden');
        }

        async function generateInvite() {
            const limitInput = prompt("Enter the maximum number of uses for this link (e.g. 5):", "5");
            if (!limitInput) return;
            const maxUses = parseInt(limitInput);
            if (isNaN(maxUses) || maxUses <= 0) {
                alert("Please enter a valid number.");
                return;
            }

            const policyInput = prompt("Enter permission level:\n1 = Read Only (Cannot upload/delete)\n2 = Read/Write (Standard)\n3 = Admin (Full Control)", "2");
            if (!policyInput) return;

            let policy = "readwrite";
            if (policyInput === "1") policy = "readonly";
            if (policyInput === "3") policy = "admin";

            const rawEndpoint = localStorage.getItem('bv_endpoint');
            const secretKey = localStorage.getItem('bv_secret');
            const adminEndpoint = rawEndpoint.replace('-api', '-admin');

            const toastId = 'toast-invite-' + Date.now();
            showToast(toastId, `Generating secure team invite...`);

            try {
                const adminEdgeLink = await resolveEndpoint(adminEndpoint);
                if (!adminEdgeLink) throw new Error("Could not connect to local Admin Engine.");

                const res = await fetch(adminEdgeLink + '/api/invite/create', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + secretKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ max_uses: maxUses, policy: policy })
                });

                if (!res.ok) throw new Error("Unauthorized. Only the server admin can create invites.");

                const data = await res.json();
                if (data.status === 'success') {

                    const inviteUrl = window.location.href.split('?')[0] + 
                                     "?invite=" + data.invite_token + 
                                     "&gateway=" + encodeURIComponent(rawEndpoint);
                    await navigator.clipboard.writeText(inviteUrl);
                    updateToast(toastId, `âœ… Invite copied! (Uses: ${maxUses}, Role: ${policy})`, true);
                }
            } catch (error) {
                updateToast(toastId, `âŒ Failed to create invite: ${error.message}`, true);
            }
        }

        async function openTeamManager() {
            document.getElementById('teamModal').classList.remove('hidden');
            document.getElementById('teamModal').classList.add('flex');

            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-gray-500 animate-pulse">Loading team registry...</td></tr>`;

            const adminEndpoint = localStorage.getItem('bv_endpoint').replace('-api', '-admin');
            const adminEdgeLink = await resolveEndpoint(adminEndpoint);

            try {
                const res = await fetch(adminEdgeLink + '/api/employees/list', {
                    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('bv_secret') }
                });
                const employees = await res.json();

                tbody.innerHTML = '';
                for (const [key, emp] of Object.entries(employees)) {
                    let roleColor = emp.role === 'admin' ? 'bg-red-900/50 text-red-400' :
                        emp.role === 'readwrite' ? 'bg-green-900/50 text-green-400' : 'bg-blue-900/50 text-blue-400';

                    tbody.innerHTML += `
                        <tr class="border-b border-gray-800 hover:bg-gray-800/50">
                            <td class="px-6 py-4 font-bold text-white">${emp.name}</td>
                            <td class="px-6 py-4"><span class="${roleColor} px-2 py-1 rounded text-[10px] uppercase tracking-wider font-bold">${emp.role || 'readwrite'}</span></td>
                            <td class="px-6 py-4 font-mono text-[10px] text-gray-500">${emp.access_key}</td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="revokeEmployee('${emp.access_key}')" class="text-xs font-bold text-red-500 border border-red-900/40 hover:text-white bg-red-900/10 hover:bg-red-600 px-4 py-1.5 rounded transition-colors">Revoke</button>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-red-500">Failed to load team data.</td></tr>`;
            }
        }

        async function revokeEmployee(accessKey) {
            if (!confirm("Permanently revoke this user's access? They will be locked out immediately.")) return;

            const adminEndpoint = localStorage.getItem('bv_endpoint').replace('-api', '-admin');
            const adminEdgeLink = await resolveEndpoint(adminEndpoint);

            const res = await fetch(adminEdgeLink + '/api/employees/revoke', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('bv_secret'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ access_key: accessKey })
            });

            if (res.ok) {
                alert("User access revoked successfully.");
                openTeamManager();
            } else {
                alert("Failed to revoke user.");
            }
        }

        function deleteCurrentBucket() {
            if (!activeBucket) return;
            if (!confirm(`WARNING: Are you sure you want to permanently delete the bucket "${activeBucket}"?\n\nThe bucket MUST be completely empty first, or this will fail.`)) return;

            s3.deleteBucket({ Bucket: activeBucket }, function (err, data) {
                if (err) {
                    alert("Delete Failed: " + err.message);
                } else {
                    activeBucket = '';
                    fetchBuckets(true);
                    alert("Bucket deleted successfully.");
                }
            });
        }

        function previewSelected() {
            const contentType = document.getElementById('drawerContentType').innerText;

            const viewableTypes = ['application/pdf', 'text/plain', 'text/csv', 'video/mp4', 'video/webm', 'audio/mpeg'];
            const isImage = contentType.startsWith('image/');
            const isViewableDoc = viewableTypes.includes(contentType) || contentType.startsWith('text/');

            if (!isImage && !isViewableDoc) {
                alert(`Cannot natively preview files of type '${contentType}'. The file will be downloaded instead.`);
                downloadSelected();
                return;
            }

            const url = s3.getSignedUrl('getObject', {
                Bucket: activeBucket,
                Key: selectedObjectKey,
                Expires: 3600,
                ResponseContentType: contentType,
                ResponseContentDisposition: 'inline'
            });

            document.getElementById('previewTitle').innerText = "Previewing: " + selectedObjectKey;

            const imgEl = document.getElementById('previewImage');
            const iframeEl = document.getElementById('previewFrame');

            if (isImage) {
                imgEl.src = url;
                imgEl.classList.remove('hidden');
                iframeEl.classList.add('hidden');
            } else {
                iframeEl.src = url;
                iframeEl.classList.remove('hidden');
                imgEl.classList.add('hidden');
            }

            document.getElementById('previewModal').classList.remove('hidden');
            document.getElementById('previewModal').classList.add('flex');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.add('hidden');
            document.getElementById('previewModal').classList.remove('flex');
            document.getElementById('previewFrame').src = '';
            document.getElementById('previewImage').src = '';
        }

        async function downloadBulk() {
            if (selectedFiles.size === 0) return;

            const filesToZip = Array.from(selectedFiles);
            const bucketSource = activeBucket;

            selectedFiles.clear();
            document.querySelectorAll('.file-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('selectAllCheckbox').checked = false;
            closeDrawer();

            const toastId = 'toast-' + Date.now();
            showToast(toastId, `Preparing batch: ${filesToZip.length} items...`);

            try {
                const zip = new JSZip();
                let downloaded = 0;

                for (const key of filesToZip) {
                    const url = s3.getSignedUrl('getObject', {
                        Bucket: bucketSource,
                        Key: key,
                        Expires: 3600
                    });

                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Failed to fetch ${key}`);

                    const blob = await response.blob();
                    zip.file(key, blob);

                    downloaded++;
                    const percent = Math.round((downloaded / filesToZip.length) * 100);
                    updateToast(toastId, `Archiving ${filesToZip.length} items... ${percent}%`);
                }

                updateToast(toastId, `Compressing archive... please wait.`);
                const zipBlob = await zip.generateAsync({ type: "blob" });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(zipBlob);
                link.download = `${bucketSource}-batch.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                URL.revokeObjectURL(link.href);
                updateToast(toastId, `âœ… Batch download complete!`, true);

            } catch (error) {
                updateToast(toastId, `âŒ Error creating ZIP: ${error.message}`, true);
            }
        }

        function showToast(id, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.id = id;
            toast.className = 'bg-minio-sidebar border border-minio-border text-gray-300 px-5 py-3 rounded shadow-2xl text-xs font-bold min-w-[280px] transition-opacity duration-300 flex items-center justify-between';
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
        }

        function updateToast(id, message, autoDismiss = false) {
            const toast = document.getElementById(id);
            if (toast) {
                toast.querySelector('span').innerText = message;
                if (autoDismiss) {
                    setTimeout(() => {
                        toast.classList.add('opacity-0');
                        setTimeout(() => toast.remove(), 300);
                    }, 4000);
                }
            }
        }

        function deleteBulk() {
            if (!confirm(`Are you sure you want to permanently delete these items?`)) return;

            const objectsToDelete = Array.from(selectedFiles).map(key => ({ Key: key }));

            s3.deleteObjects({
                Bucket: activeBucket,
                Delete: { Objects: objectsToDelete, Quiet: false }
            }, function (err, data) {
                if (err) alert("Delete Failed: " + err.message);
                else {
                    selectedFiles.clear();
                    closeDrawer();
                    refreshCurrentBucket();
                }
            });
        }

        function shareSelected() {
            const url = s3.getSignedUrl('getObject', {
                Bucket: activeBucket,
                Key: selectedObjectKey,
                Expires: 604800 
            });

            navigator.clipboard.writeText(url).then(() => {
                alert('âœ… Shareable link copied to clipboard! (Valid for 7 days)');
            }).catch(err => {
                prompt("Copy this link manually:", url);
            });
        }

        function tagsSelected() {
            alert('Object Tagging API requires additional IAM policy setup. Coming soon!');
        }

        function downloadSelected() {
            const url = s3.getSignedUrl('getObject', {
                Bucket: activeBucket,
                Key: selectedObjectKey,
                Expires: 60,
                ResponseContentDisposition: `attachment; filename="${selectedObjectKey}"`
            });
            window.location.href = url;
        }

        function deleteSelected() {
            if (!confirm(`Are you sure you want to permanently delete ${selectedObjectKey}?`)) return;
            s3.deleteObject({ Bucket: activeBucket, Key: selectedObjectKey }, function (err, data) {
                if (err) alert("Delete Failed: " + err.message);
                else {
                    closeDrawer();
                    refreshCurrentBucket();
                }
            });
        }

        function showError(msg) {
            const errEl = document.getElementById('loginError');
            errEl.innerText = msg;
            errEl.classList.remove('hidden');
        }

        function logout() {
            localStorage.clear();
            window.location.href = window.location.href.split('?')[0];
        }
    </script>
</body>

</html>
